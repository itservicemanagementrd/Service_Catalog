(()=>{var C=Object.defineProperty;var S=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable;var w=(d,e,t)=>e in d?C(d,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):d[e]=t,v=(d,e)=>{for(var t in e||(e={}))I.call(e,t)&&w(d,t,e[t]);if(S)for(var t of S(e))L.call(e,t)&&w(d,t,e[t]);return d};var A=(d,e)=>()=>(e||d((e={exports:{}}).exports,e),e.exports);var $=A(()=>{var T=()=>Date.now().toString(36)+Math.random().toString(36).substr(2),y={criticalities:["Alta","Media","Baja","Cr\xEDtica","Extrema"],statuses:["En Desarrollo","Activo","Inactivo","Retirado"],ci_types:["Servidor","Aplicaci\xF3n","Red","Base de Datos","Hardware"],ci_statuses:["Operativo","En Mantenimiento","Fuera de Servicio"],request_types:["Solicitud de Servicio","Info","Acceso"],assignment_groups:["Mesa de Ayuda","Infraestructura","Desarrollo","Seguridad"],contacts:["Admin","Soporte","Gerente IT"]},g=d=>{let e=d.getSettings();return{services:{label:"Servicio de Negocio",icon:"\u{1F4BC}",fields:[{name:"name",label:"Nombre del Servicio",type:"text",required:!0},{name:"description",label:"Descripci\xF3n",type:"textarea",required:!0},{name:"owner",label:"Propietario (Service Owner)",type:"select",options:e.contacts,required:!0},{name:"manager",label:"Gestor (Service Manager)",type:"select",options:e.contacts},{name:"criticality",label:"Criticidad",type:"select",options:e.criticalities,required:!0},{name:"availability",label:"Horario Disponibilidad",type:"text",placeholder:"Ej. 24/7, Lun-Vie 9-6"},{name:"sla_response",label:"SLA Respuesta (Horas)",type:"number"},{name:"cost",label:"Costo Mensual ($)",type:"number"},{name:"status",label:"Estado",type:"select",options:e.statuses,required:!0},{name:"customers",label:"Clientes/Usuarios",type:"text"}],relations:[{name:"linked_cis",label:"CIs Relacionados",target:"components",multiple:!0},{name:"linked_requests",label:"Peticiones Asociadas",target:"requests",multiple:!0}]},components:{label:"Componente (CI)",icon:"\u{1F9E9}",fields:[{name:"name",label:"Nombre del CI",type:"text",required:!0},{name:"type",label:"Tipo de CI",type:"select",options:e.ci_types,required:!0},{name:"status",label:"Estado",type:"select",options:e.ci_statuses,required:!0},{name:"tech_owner",label:"Propietario T\xE9cnico",type:"select",options:e.contacts},{name:"location",label:"Ubicaci\xF3n F\xEDsica/L\xF3gica",type:"text"},{name:"version",label:"Versi\xF3n/Modelo",type:"text"}],relations:[{name:"parent_service",label:"Servicio Padre",target:"services",multiple:!1}]},requests:{label:"Cat\xE1logo de Peticiones",icon:"\u{1F4CB}",fields:[{name:"name",label:"Nombre Solicitud",type:"text",required:!0},{name:"type",label:"Tipo",type:"select",options:e.request_types,required:!0},{name:"category",label:"Categor\xEDa",type:"text"},{name:"tat",label:"Tiempo Cumplimiento (D\xEDas)",type:"number"},{name:"approvals",label:"Aprobaciones Requeridas",type:"select",options:["Ninguna","Manager","Owner","Director"]},{name:"cost",label:"Costo ($)",type:"number"}],relations:[{name:"related_service",label:"Servicio Asociado",target:"services",multiple:!1}]},technical:{label:"Informaci\xF3n T\xE9cnica",icon:"\u{1F527}",fields:[{name:"category",label:"Categor\xEDa Incidente",type:"text",required:!0},{name:"subcategory",label:"Subcategor\xEDa",type:"text"},{name:"L1_group",label:"Grupo Asignaci\xF3n L1",type:"select",options:e.assignment_groups,required:!0},{name:"L2_group",label:"Grupo Asignaci\xF3n L2",type:"select",options:e.assignment_groups},{name:"escalation",label:"Procedimiento Escalado",type:"textarea"},{name:"priority",label:"Prioridad T\xE9cnica",type:"select",options:["P1","P2","P3","P4"]},{name:"kb_articles",label:"Art\xEDculos KB Relacionados",type:"textarea"}],relations:[{name:"related_service_tech",label:"Aplica al Servicio",target:"services",multiple:!0}]}}},b=class{constructor(){this.STORAGE_KEY="ITSM_CATALOG_DATA_V1",this.data=this.load()}getEmptyState(){return{services:[],components:[],requests:[],technical:[],settings:JSON.parse(JSON.stringify(y))}}load(){let e=localStorage.getItem(this.STORAGE_KEY);if(e){let t=JSON.parse(e);return t.settings||(t.settings=JSON.parse(JSON.stringify(y))),t}return this.getEmptyState()}save(){localStorage.setItem(this.STORAGE_KEY,JSON.stringify(this.data))}getSettings(){return this.data.settings}updateSettingList(e,t){this.data.settings[e]&&(this.data.settings[e]=t,this.save())}add(e,t){return t.id=T(),t.createdAt=new Date().toISOString(),this.data[e].push(t),this.save(),t}update(e,t,s){let a=this.data[e].findIndex(c=>c.id===t);return a>-1?(this.data[e][a]=v(v({},this.data[e][a]),s),this.save(),!0):!1}delete(e,t){this.data[e]=this.data[e].filter(s=>s.id!==t),this.save()}get(e,t){return this.data[e].find(s=>s.id===t)}getAll(e){return this.data[e]||[]}importData(e){try{let t=JSON.parse(e);return t.services&&Array.isArray(t.services)?(t.settings||(t.settings=JSON.parse(JSON.stringify(y))),this.data=t,this.save(),!0):!1}catch(t){return console.error("Import failed",t),!1}}},f=class{constructor(e,t){this.store=e,this.events=t,this.container=document.getElementById("view-container"),this.modal=document.getElementById("modal-overlay"),this.form=document.getElementById("dynamic-form"),this.modalTitle=document.getElementById("modal-title")}showToast(e,t="info"){let s=document.getElementById("toast-container"),a=document.createElement("div");a.className=`toast ${t}`,a.innerHTML=`<span>${t==="success"?"\u2714":"\u2139"}</span> ${e}`,s.appendChild(a),setTimeout(()=>a.remove(),3e3)}renderSettings(){this.container.innerHTML="";let e=this.store.getSettings(),t=document.createElement("div");t.className="data-grid";let s={criticalities:"Niveles de Criticidad",statuses:"Estados de Servicio",ci_types:"Tipos de CI",ci_statuses:"Estados de CI",request_types:"Tipos de Solicitud",assignment_groups:"Grupos de Asignaci\xF3n",contacts:"Contactos / Personas"};Object.keys(e).forEach(a=>{let c=document.createElement("div");c.className="card";let i=e[a].map((r,o)=>`<div style="display:flex; justify-content:space-between; padding:4px 0; border-bottom:1px solid #334155;">
                    <span>${r}</span>
                    <button class="small-btn danger-btn remove-setting" data-key="${a}" data-idx="${o}" style="padding:2px 6px;">\xD7</button>
                 </div>`).join("");c.innerHTML=`
                <div class="card-header">
                    <div class="card-title">${s[a]||a}</div>
                </div>
                <div class="card-body" style="max-height: 200px; overflow-y: auto;">
                    ${i}
                </div>
                <div class="card-actions" style="display:flex; gap:5px;">
                    <input type="text" id="new-${a}" placeholder="Nuevo valor..." style="flex:1; padding:5px; border-radius:4px; border:1px solid #334155; background:#0f172a; color:white;">
                    <button class="primary-btn small-btn add-setting" data-key="${a}">+</button>
                </div>
            `,c.querySelector(".add-setting").addEventListener("click",r=>{let n=document.getElementById(`new-${a}`).value.trim();console.log(n),n&&this.events.emit("setting-add",{key:a,value:n})}),c.querySelectorAll(".remove-setting").forEach(r=>{r.addEventListener("click",o=>{let n=parseInt(o.target.dataset.idx);this.events.emit("setting-remove",{key:a,idx:n})})}),t.appendChild(c)}),this.container.appendChild(t)}renderCard(e,t,s){let a=t.status?`status-${t.status.toLowerCase().replace(" ","-")}`:"",c=t.status?`<span class="status-badge ${a}">${t.status}</span>`:"",i=t.status==="Inactivo"?"opacity: 0.6; border: 1px dashed #475569;":"",r="";e.fields.slice(1,4).forEach(h=>{if(t[h.name]){let p=typeof t[h.name]=="object"?"...":t[h.name];r+=`
                    <div class="field-group">
                        <span class="field-label">${h.label}</span>
                        <div class="field-value">${p}</div>
                    </div>
                `}});let o="";e.relations&&e.relations.forEach(h=>{let p=t[h.name];if(p&&(Array.isArray(p)?p.length>0:p)){let x=Array.isArray(p)?p.length:1;o+=`<span style="font-size:0.75rem; background:rgba(255,255,255,0.1); padding:2px 6px; border-radius:4px; margin-right:4px;">${h.label}: ${x}</span>`}});let n=document.createElement("div");n.className="card",n.style=i;let l=`
            <button class="card-action-btn view" data-id="${t.id}" data-collection="${s}">\u{1F441} Visualizar</button>
            <button class="card-action-btn edit" data-id="${t.id}" data-collection="${s}">\u270E Editar</button>
        `;t.status!=="Inactivo"&&t.status!=="Retirado"?l+=`<button class="card-action-btn danger deactivate" data-id="${t.id}" data-collection="${s}">\u{1F6AB} Inactivar</button>`:l+=`<button class="card-action-btn delete" data-id="${t.id}" data-collection="${s}">\u{1F5D1} Eliminar</button>`,n.innerHTML=`
            <div class="card-header">
                <div class="card-title">${t.name||t.category||"Sin Nombre"}</div>
                ${c}
            </div>
            <div class="card-body">
                ${r}
                <div style="margin-top:0.5rem">${o}</div>
            </div>
            <div class="card-actions">
                ${l}
            </div>
        `,n.querySelector(".view").addEventListener("click",()=>this.events.emit("view",{collection:s,id:t.id})),n.querySelector(".edit").addEventListener("click",()=>this.events.emit("edit",{collection:s,id:t.id}));let u=n.querySelector(".deactivate");u&&u.addEventListener("click",()=>{confirm("\xBFInactivar este registro?")&&this.events.emit("deactivate",{collection:s,id:t.id})});let m=n.querySelector(".delete");return m&&m.addEventListener("click",()=>{confirm("\xBFEliminar permanentemente?")&&this.events.emit("delete",{collection:s,id:t.id})}),n}renderGrid(e,t=""){this.container.innerHTML="";let s=this.store.getAll(e),c=g(this.store)[e],i=document.createElement("div");i.className="data-grid";let r=s.filter(o=>JSON.stringify(o).toLowerCase().includes(t.toLowerCase()));if(r.length===0){this.container.innerHTML=`<div class="empty-state" style="text-align:center; padding:3rem; color: #64748b;">
                <h3>No hay registros</h3>
                <p>Crea un nuevo ${c.label} para comenzar.</p>
            </div>`;return}r.forEach(o=>{i.appendChild(this.renderCard(c,o,e))}),this.container.appendChild(i)}openModal(e,t=null){let a=g(this.store)[e],c=t?this.store.get(e,t):{};this.modalTitle.textContent=t?`Editar ${a.label}`:`Crear ${a.label}`,this.form.innerHTML="",this.form.dataset.collection=e,this.form.dataset.itemId=t||"",a.fields.forEach(i=>{let r=document.createElement("div");r.className="form-group";let o=document.createElement("label");o.textContent=i.label,r.appendChild(o);let n,l=c[i.name]||"";i.type==="textarea"?(n=document.createElement("textarea"),n.rows=3):i.type==="select"?(n=document.createElement("select"),i.options.forEach(u=>{let m=document.createElement("option");m.value=u,m.textContent=u,l===u&&(m.selected=!0),n.appendChild(m)})):(n=document.createElement("input"),n.type=i.type),n.name=i.name,i.required&&(n.required=!0),l&&i.type!=="select"&&(n.value=l),i.placeholder&&(n.placeholder=i.placeholder),r.appendChild(n),this.form.appendChild(r)}),a.relations&&a.relations.forEach(i=>{let r=document.createElement("div");r.className="form-group",r.innerHTML=`<label>${i.label}</label>`;let o=document.createElement("select");o.name=i.name,i.multiple&&(o.multiple=!0),o.style.height=i.multiple?"100px":"auto";let n=this.store.getAll(i.target);if(!i.multiple){let l=document.createElement("option");l.value="",l.textContent="-- Seleccionar --",o.appendChild(l)}n.forEach(l=>{let u=document.createElement("option");u.value=l.id,u.textContent=l.name||l.category||"Unnamed";let m=c[i.name];i.multiple?m&&m.includes(l.id)&&(u.selected=!0):m===l.id&&(u.selected=!0),o.appendChild(u)}),r.appendChild(o),this.form.appendChild(r)}),this.form.querySelectorAll("input, select, textarea").forEach(i=>i.disabled=!1),document.querySelector(".modal-footer").style.display="flex",this.modal.classList.remove("hidden")}openViewModal(e,t){this.openModal(e,t),this.modalTitle.textContent="Visualizar Detalle",this.form.querySelectorAll("input, select, textarea").forEach(s=>s.disabled=!0),document.querySelector(".modal-footer").style.display="none"}closeModal(){this.modal.classList.add("hidden"),this.form.reset(),document.querySelector(".modal-footer").style.display="flex"}},E=class{constructor(){this.store=new b,this.currentView="services",this.events={listeners:{},on(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},emit(e,t){this.listeners[e]&&this.listeners[e].forEach(s=>s(t))}},this.ui=new f(this.store,this.events),this.init()}init(){this.bindEvents(),this.switchView("services"),console.log("ITSM App Initialized")}bindEvents(){document.querySelectorAll(".nav-btn").forEach(e=>{e.addEventListener("click",t=>{let s=t.currentTarget.dataset.view;this.switchView(s)})}),document.getElementById("btn-create").addEventListener("click",()=>{this.ui.openModal(this.currentView)}),document.getElementById("global-search").addEventListener("input",e=>{this.currentView!=="settings"&&this.ui.renderGrid(this.currentView,e.target.value)}),document.getElementById("btn-close-modal").addEventListener("click",()=>this.ui.closeModal()),document.getElementById("btn-cancel-modal").addEventListener("click",()=>this.ui.closeModal()),document.getElementById("dynamic-form").addEventListener("submit",e=>{e.preventDefault(),this.handleFormSubmit(e.target)}),this.events.on("edit",e=>{this.ui.openModal(e.collection,e.id)}),this.events.on("view",e=>{this.ui.openViewModal(e.collection,e.id)}),this.events.on("deactivate",e=>{this.store.update(e.collection,e.id,{status:"Inactivo"}),this.ui.showToast("Registro inactivado","info"),this.refresh()}),this.events.on("delete",e=>{this.store.delete(e.collection,e.id),this.ui.showToast("Registro eliminado","success"),this.refresh()}),this.events.on("setting-add",({key:e,value:t})=>{let s=this.store.getSettings()[e];s.includes(t)||(s.push(t),this.store.updateSettingList(e,s),this.ui.renderSettings(),this.ui.showToast("Opci\xF3n agregada","success"))}),this.events.on("setting-remove",({key:e,idx:t})=>{let s=this.store.getSettings()[e];s.splice(t,1),this.store.updateSettingList(e,s),this.ui.renderSettings()}),document.getElementById("btn-reset").addEventListener("click",()=>{confirm("ATENCI\xD3N: Esto borrar\xE1 todos los datos. \xBFEst\xE1s seguro?")&&(localStorage.removeItem(this.store.STORAGE_KEY),location.reload())}),document.getElementById("btn-export").addEventListener("click",()=>{let e=JSON.stringify(this.store.data,null,2),t=new Blob([e],{type:"application/json"}),s=URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download=`itsm-backup-${new Date().toISOString().slice(0,10)}.json`,a.click()}),document.getElementById("file-import").addEventListener("change",e=>{let t=e.target.files[0];if(!t)return;let s=new FileReader;s.onload=a=>{this.store.importData(a.target.result)?(this.ui.showToast("Datos importados correctamente","success"),location.reload()):this.ui.showToast("Error al importar datos","error")},s.readAsText(t)})}switchView(e){if(this.currentView=e,document.querySelectorAll(".nav-btn").forEach(t=>t.classList.remove("active")),document.querySelector(`[data-view="${e}"]`).classList.add("active"),e==="settings")document.getElementById("page-title").textContent="Configuraci\xF3n del Sistema",document.getElementById("btn-create").style.display="none",document.getElementById("global-search").style.display="none",this.ui.renderSettings();else{let t=g(this.store);t[e]&&(document.getElementById("page-title").textContent=t[e].label),document.getElementById("btn-create").style.display="block",document.getElementById("global-search").style.display="block",this.refresh()}}refresh(){this.currentView!=="settings"&&this.ui.renderGrid(this.currentView,document.getElementById("global-search").value)}handleFormSubmit(e){let t=new FormData(e),s=Object.fromEntries(t.entries()),c=g(this.store)[this.currentView];c.relations&&c.relations.forEach(r=>{if(r.multiple){let o=e.querySelector(`select[name="${r.name}"]`),n=Array.from(o.selectedOptions).map(l=>l.value);s[r.name]=n}});let i=e.dataset.itemId;i?(this.store.update(this.currentView,i,s),this.ui.showToast("Registro actualizado","success")):(this.store.add(this.currentView,s),this.ui.showToast("Registro creado","success")),this.ui.closeModal(),this.refresh()}};document.addEventListener("DOMContentLoaded",()=>{window.app=new E})});$();})();
//# sourceMappingURL=app.js.map
